#!/bin/bash
"""
ç”Ÿäº§çŽ¯å¢ƒå‰ç«¯å¯åŠ¨è„šæœ¬
"""

echo "ðŸ–¥ï¸  å¯åŠ¨ç”Ÿäº§çŽ¯å¢ƒå‰ç«¯æœåŠ¡..."

# æ£€æŸ¥æ˜¯å¦åœ¨æ­£ç¡®çš„ç›®å½•
if [ ! -d "../frontend" ]; then
    echo "âŒ é”™è¯¯: æœªæ‰¾åˆ°å‰ç«¯ç›®å½•ï¼Œè¯·ç¡®ä¿åœ¨backendç›®å½•ä¸‹è¿è¡Œæ­¤è„šæœ¬"
    exit 1
fi

# åˆ‡æ¢åˆ°å‰ç«¯ç›®å½•
cd ../frontend

# å¤åˆ¶ç”Ÿäº§çŽ¯å¢ƒé…ç½®
echo "ðŸ”§ é…ç½®ç”Ÿäº§çŽ¯å¢ƒ..."
cp ../backend/env_production.txt .env.production

# æ˜¾ç¤ºé…ç½®ä¿¡æ¯
echo "ðŸŒ çŽ¯å¢ƒ: ç”Ÿäº§çŽ¯å¢ƒ"
echo "ðŸ  å‰ç«¯åœ°å€: http://9.135.87.101:8701"
echo "ðŸŒ APIåœ°å€: http://9.135.87.101:7860/api"

# æ£€æŸ¥ä¾èµ–
if [ ! -d "node_modules" ]; then
    echo "ðŸ“¦ å®‰è£…å‰ç«¯ä¾èµ–..."
    npm install
fi

# ç”Ÿäº§çŽ¯å¢ƒæž„å»ºï¼ˆå¯é€‰ï¼‰
echo "ðŸ”¨ æž„å»ºç”Ÿäº§ç‰ˆæœ¬..."
npm run build

# å¯åŠ¨å‰ç«¯æœåŠ¡ï¼ˆç”Ÿäº§æ¨¡å¼ï¼‰
echo "ðŸš€ å¯åŠ¨å‰ç«¯æœåŠ¡ (ç«¯å£: 8701)..."
# ä½¿ç”¨serveæ¥å¯åŠ¨ç”Ÿäº§æž„å»º
if command -v serve &> /dev/null; then
    serve -s build -l 8701
else
    echo "ðŸ“¦ å®‰è£…serveå·¥å…·..."
    npm install -g serve
    serve -s build -l 8701
fi 