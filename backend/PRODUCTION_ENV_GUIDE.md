# ç”Ÿäº§ç¯å¢ƒé…ç½®æŒ‡å—ï¼šç¡®ä¿ä½¿ç”¨.env.production

## ğŸ¯ é—®é¢˜èƒŒæ™¯

Reactåº”ç”¨åœ¨æ„å»ºæ—¶ä¼šæŒ‰ç…§ç‰¹å®šçš„ä¼˜å…ˆçº§åŠ è½½ç¯å¢ƒå˜é‡æ–‡ä»¶ï¼Œå¦‚æœå­˜åœ¨å¤šä¸ªç¯å¢ƒæ–‡ä»¶ï¼Œå¯èƒ½å¯¼è‡´ç”Ÿäº§ç¯å¢ƒæ— æ³•æ­£ç¡®ä½¿ç”¨`.env.production`é…ç½®ã€‚

## ğŸ“‹ Reactç¯å¢ƒå˜é‡åŠ è½½ä¼˜å…ˆçº§

ReactæŒ‰ä»¥ä¸‹é¡ºåºåŠ è½½ç¯å¢ƒå˜é‡ï¼ˆä»é«˜åˆ°ä½ä¼˜å…ˆçº§ï¼‰ï¼š

1. **å‘½ä»¤è¡Œç¯å¢ƒå˜é‡**ï¼ˆæœ€é«˜ä¼˜å…ˆçº§ï¼‰
   ```bash
   REACT_APP_API_URL=http://9.135.87.101:7860/api npm run build
   ```

2. **`.env.production.local`**ï¼ˆç”Ÿäº§ç¯å¢ƒæœ¬åœ°è¦†ç›–ï¼‰
   - ä»…åœ¨ç”Ÿäº§æ„å»ºæ—¶åŠ è½½
   - ä¼šè¦†ç›–`.env.production`

3. **`.env.local`**ï¼ˆæœ¬åœ°ç¯å¢ƒè¦†ç›–ï¼‰âš ï¸ **å±é™©**
   - åœ¨æ‰€æœ‰ç¯å¢ƒä¸­éƒ½ä¼šåŠ è½½
   - **ä¼šè¦†ç›–`.env.production`é…ç½®**

4. **`.env.production`**ï¼ˆç”Ÿäº§ç¯å¢ƒé…ç½®ï¼‰âœ… **ç›®æ ‡**
   - ä»…åœ¨ç”Ÿäº§æ„å»ºæ—¶åŠ è½½
   - æˆ‘ä»¬å¸Œæœ›ä½¿ç”¨çš„é…ç½®æ–‡ä»¶

5. **`.env`**ï¼ˆé»˜è®¤ç¯å¢ƒé…ç½®ï¼‰
   - åœ¨æ‰€æœ‰ç¯å¢ƒä¸­éƒ½ä¼šåŠ è½½
   - ä¼˜å…ˆçº§æœ€ä½

## ğŸ” æ£€æŸ¥å½“å‰ç¯å¢ƒæ–‡ä»¶çŠ¶æ€

### ä½¿ç”¨éªŒè¯è„šæœ¬
```bash
cd backend
./verify_frontend_config.sh
```

éªŒè¯è„šæœ¬ä¼šæ£€æŸ¥ï¼š
- âœ… `.env.production`æ–‡ä»¶æ˜¯å¦å­˜åœ¨ä¸”é…ç½®æ­£ç¡®
- âš ï¸ æ˜¯å¦å­˜åœ¨ä¼šè¦†ç›–`.env.production`çš„å†²çªæ–‡ä»¶
- âœ… package.jsonä¸­æ˜¯å¦æœ‰proxyé…ç½®å†²çª
- âœ… æ„å»ºç»“æœä¸­æ˜¯å¦åŒ…å«æ­£ç¡®çš„APIåœ°å€

### æ‰‹åŠ¨æ£€æŸ¥
```bash
cd frontend
ls -la .env*
```

æŸ¥çœ‹å„æ–‡ä»¶çš„APIé…ç½®ï¼š
```bash
grep "REACT_APP_API_URL" .env* 2>/dev/null
```

## ğŸ”§ è§£å†³ç¯å¢ƒæ–‡ä»¶å†²çª

### è‡ªåŠ¨åŒ–è§£å†³æ–¹æ¡ˆï¼ˆæ¨èï¼‰
```bash
cd backend
./ensure_production_env.sh
```

é€‰æ‹©æ–¹æ¡ˆï¼š
- **æ–¹æ¡ˆ1ï¼šé‡å‘½åå†²çªæ–‡ä»¶**ï¼ˆæ¨èï¼‰
  - å°†å†²çªæ–‡ä»¶é‡å‘½åä¸º`.disabled`åç¼€
  - ä¿ç•™åŸæ–‡ä»¶ä¾¿äºæ¢å¤
  
- **æ–¹æ¡ˆ2ï¼šåˆ é™¤å†²çªæ–‡ä»¶**
  - ç›´æ¥åˆ é™¤å†²çªæ–‡ä»¶
  - ä¸å¯æ¢å¤ï¼Œè°¨æ…ä½¿ç”¨

### æ‰‹åŠ¨è§£å†³æ–¹æ¡ˆ
```bash
cd frontend

# é‡å‘½åå†²çªæ–‡ä»¶
mv .env.local .env.local.disabled
mv .env .env.disabled

# æˆ–ç›´æ¥åˆ é™¤ï¼ˆè°¨æ…ï¼‰
rm .env.local .env
```

## ğŸš€ ç¡®ä¿æ­£ç¡®æ„å»ºçš„æ–¹æ³•

### æ–¹æ³•1ï¼šæ¸…ç†ç¯å¢ƒåæ„å»ºï¼ˆæ¨èï¼‰
```bash
# 1. å¤„ç†ç¯å¢ƒæ–‡ä»¶å†²çª
cd backend
./ensure_production_env.sh

# 2. é‡æ–°æ„å»º
cd ../frontend
rm -rf build
npm run build
```

### æ–¹æ³•2ï¼šå‘½ä»¤è¡Œå¼ºåˆ¶æŒ‡å®šï¼ˆæœ€å®‰å…¨ï¼‰
```bash
cd frontend
REACT_APP_API_URL=http://9.135.87.101:7860/api npm run build
```

### æ–¹æ³•3ï¼šä½¿ç”¨ç”Ÿäº§å¯åŠ¨è„šæœ¬ï¼ˆå…¨è‡ªåŠ¨ï¼‰
```bash
cd backend
./start_frontend_production.sh
```

## âœ… éªŒè¯é…ç½®æ­£ç¡®æ€§

### 1. ç¯å¢ƒæ–‡ä»¶éªŒè¯
```bash
cd backend
./verify_frontend_config.sh
```

åº”è¯¥çœ‹åˆ°ï¼š
- âœ… API URLé…ç½®æ­£ç¡®: http://9.135.87.101:7860/api
- âœ… æ— ç¯å¢ƒæ–‡ä»¶å†²çª
- âœ… æ„å»ºæ–‡ä»¶åŒ…å«æ­£ç¡®çš„APIåœ°å€

### 2. æ„å»ºæ–‡ä»¶éªŒè¯
```bash
cd frontend
# æ£€æŸ¥æ„å»ºç»“æœä¸­çš„APIé…ç½®
grep -o "http://[^\"]*api" build/static/js/main.*.js
```

åº”è¯¥è¾“å‡ºï¼š`http://9.135.87.101:7860/api`

### 3. è¿è¡Œæ—¶éªŒè¯
å¯åŠ¨å‰ç«¯æœåŠ¡åï¼Œåœ¨æµè§ˆå™¨å¼€å‘è€…å·¥å…·ä¸­æ£€æŸ¥ï¼š
```javascript
// åœ¨æµè§ˆå™¨æ§åˆ¶å°ä¸­æ‰§è¡Œ
console.log('API URL:', process.env.REACT_APP_API_URL);
```

## ğŸ› ï¸ å¸¸è§é—®é¢˜è§£å†³

### é—®é¢˜1ï¼šæ„å»ºåä»ç„¶ä½¿ç”¨é”™è¯¯çš„APIåœ°å€
**åŸå› **ï¼šå­˜åœ¨é«˜ä¼˜å…ˆçº§çš„ç¯å¢ƒæ–‡ä»¶è¦†ç›–äº†`.env.production`

**è§£å†³**ï¼š
```bash
cd backend
./ensure_production_env.sh  # é€‰æ‹©æ–¹æ¡ˆ1é‡å‘½åå†²çªæ–‡ä»¶
cd ../frontend
rm -rf build && npm run build
```

### é—®é¢˜2ï¼šå¼€å‘ç¯å¢ƒé…ç½®å½±å“ç”Ÿäº§ç¯å¢ƒ
**åŸå› **ï¼š`.env.local`åœ¨æ‰€æœ‰ç¯å¢ƒä¸­éƒ½ä¼šåŠ è½½

**è§£å†³**ï¼š
```bash
# é‡å‘½å.env.localä¸ºå¼€å‘ä¸“ç”¨
mv .env.local .env.development.local
```

### é—®é¢˜3ï¼šå›¢é˜Ÿæˆå‘˜ç¯å¢ƒä¸ä¸€è‡´
**åŸå› **ï¼šä¸åŒæˆå‘˜çš„æœ¬åœ°ç¯å¢ƒæ–‡ä»¶ä¸åŒ

**è§£å†³**ï¼š
1. æ·»åŠ åˆ°`.gitignore`ï¼š
   ```
   .env.local
   .env.development.local
   .env.test.local
   .env.production.local
   ```

2. ç»Ÿä¸€ä½¿ç”¨æ„å»ºè„šæœ¬ï¼š
   ```bash
   ./start_frontend_production.sh
   ```

## ğŸ“ æœ€ä½³å®è·µ

### 1. ç¯å¢ƒæ–‡ä»¶ç®¡ç†
- âœ… åªä¿ç•™`.env.production`ç”¨äºç”Ÿäº§ç¯å¢ƒ
- âœ… ä½¿ç”¨`.env.development.local`ç”¨äºå¼€å‘ç¯å¢ƒä¸ªäººé…ç½®
- âŒ é¿å…ä½¿ç”¨`.env.local`ï¼ˆä¼šå½±å“æ‰€æœ‰ç¯å¢ƒï¼‰
- âŒ é¿å…æäº¤ä¸ªäººæœ¬åœ°é…ç½®åˆ°Git

### 2. æ„å»ºæµç¨‹
- âœ… æ„å»ºå‰æ£€æŸ¥ç¯å¢ƒæ–‡ä»¶å†²çª
- âœ… ä½¿ç”¨å‘½ä»¤è¡Œå‚æ•°å¼ºåˆ¶æŒ‡å®šå…³é”®é…ç½®
- âœ… éªŒè¯æ„å»ºç»“æœä¸­çš„é…ç½®æ­£ç¡®æ€§

### 3. å›¢é˜Ÿåä½œ
- âœ… ä½¿ç”¨ç»Ÿä¸€çš„æ„å»ºè„šæœ¬
- âœ… å®šæœŸéªŒè¯ç”Ÿäº§ç¯å¢ƒé…ç½®
- âœ… æ–‡æ¡£åŒ–ç¯å¢ƒé…ç½®è¦æ±‚

## ğŸ”— ç›¸å…³è„šæœ¬å’Œå·¥å…·

- `./verify_frontend_config.sh` - é…ç½®éªŒè¯å·¥å…·
- `./ensure_production_env.sh` - ç¯å¢ƒå†²çªå¤„ç†å·¥å…·
- `./start_frontend_production.sh` - ç”Ÿäº§ç¯å¢ƒå¯åŠ¨è„šæœ¬

## ğŸ“š å‚è€ƒèµ„æ–™

- [Create React App - Environment Variables](https://create-react-app.dev/docs/adding-custom-environment-variables/)
- [React Environment Variables Priority](https://create-react-app.dev/docs/adding-custom-environment-variables/#what-other-env-files-can-be-used) 